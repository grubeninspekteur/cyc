---
- name: remove index.html
  command: rm /var/lib/tomcat7/webapps/ROOT/index.html removes=/var/lib/tomcat7/webapps/ROOT/index.html

- name: set redirect on /
  lineinfile: dest=/var/lib/tomcat7/webapps/ROOT/index.jsp create=yes line="<%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" session=\"false\" %><% if(!request.isSecure()) { response.sendRedirect(\"https://codeyourrestaurant.com/cyr\"); return; } response.sendRedirect(\"/cyr\"); %>"

- name: change permission on new file  
  file: mode=0755 name=/var/lib/tomcat7/webapps/ROOT/index.jsp

- name: install latest war to tmp (ignore_change)
  copy: src='cyr##001.war' dest='/tmp'
  changed_when: False

- name: update engine
  cyc: src=/tmp/cyr##001.war dest=/var/lib/tomcat7/webapps dtype=web
